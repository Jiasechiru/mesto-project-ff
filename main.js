(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){document.addEventListener("click",r),document.addEventListener("keydown",o),t.classList.add("popup_is-opened")}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),document.removeEventListener("click",r)}function o(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function r(t){t.target.classList.contains("popup")&&n(t.target)}t.d({},{J:()=>P});var c="09bd2be3-701c-436b-a468-5ff8e0c4960c",a="https://nomoreparties.co/v1/cohort-mag-4/",i=document.querySelector("#card-template").content;function u(t){t.target.classList.toggle("card__like-button_is-active")}function l(t){t.target.closest(".card").remove()}function s(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function d(t,e){var n=t.querySelector(e.submitButtonSelector);Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){s(t,n,e)})),n.disabled=!0,n.classList.add(e.inactiveButtonClass)}function p(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var m=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),h=document.querySelector(".popup_type_avatar"),g=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__image"),k=document.querySelectorAll(".popup__close"),C=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function x(t){E.setAttribute("src",t.target.src),E.setAttribute("alt",t.target.alt),L.textContent=t.target.alt,e(y)}function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",n=function(t,e){var n=i.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__like-button"),u=n.querySelector(".card__like-count");o.src=t.link,o.alt=t.name,n.querySelector(".card__title").textContent=t.name,n.querySelector(".card__delete-button").addEventListener("click",(function(e){var n;(n=t._id,fetch("".concat(a,"cards/").concat(n),{method:"DELETE",headers:{authorization:c}}).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status))}))).catch((function(t){console.log(t)})),l(e)})),o.addEventListener("click",e.cardImgHandler),r.addEventListener("click",(function(n){var o;n.preventDefault(),e.cardLike(n),t.likes.find((function(t){return t._id===P}))?(o=t._id,fetch("".concat(a,"cards/likes/").concat(o),{method:"DELETE",headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){u.textContent=e.likes.length,t.likes=e.likes})).catch((function(t){console.log(t)})):function(t){return fetch("".concat(a,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(t._id).then((function(e){u.textContent=e.likes.length,t.likes=e.likes})).catch((function(t){console.log(t)}))})),t.likes.find((function(t){return t._id===P}))&&r.classList.add("card__like-button_is-active"),u.textContent=t.likes.length;var s=n.querySelector(".card__delete-button");return t.owner._id!==P&&n.removeChild(s),n}(t,{cardLike:u,cardImgHandler:x,deleteCard:l});m[e](n)}g.addEventListener("click",(function(t){e(v);var n=document.forms["edit-profile"];n.elements.name.value=C.textContent,n.elements.description.value=q.textContent,d(n,j)})),b.addEventListener("click",(function(t){e(_)})),S.addEventListener("click",(function(t){t.preventDefault(),e(h)})),document.forms["edit-profile"].addEventListener("submit",(function(t){var e,o;t.target.querySelector(".popup__button").textContent="Сохранение...",t.preventDefault(),(e=t.target.elements.name.value,o=t.target.elements.description.value,fetch("".concat(a,"users/me"),{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){C.textContent=e.name,q.textContent=e.about,t.target.querySelector(".popup__button").textContent="Сохранить",n(v)})).catch((function(t){console.log(t)}))})),document.forms["new-place"].addEventListener("submit",(function(t){var e,o;t.preventDefault(),t.target.querySelector(".popup__button").textContent="Сохранение...",(e=t.target.elements["place-name"].value,o=t.target.elements.link.value,fetch("".concat(a,"cards"),{method:"POST",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){A(e),t.target.querySelector(".popup__button").textContent="Сохранить",n(_)})).catch((function(t){console.log(t)})),t.target.reset(),d(t.target,j)})),document.forms["change-avatar"].addEventListener("submit",(function(t){t.preventDefault(),t.target.querySelector(".popup__button").textContent="Сохранение...";var e=t.target.elements.link.value;(function(t){return fetch("".concat(a,"users/me/avatar"),{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status))}))})(e).then((function(){n(h),t.target.querySelector(".popup__button").textContent="Сохранить",d(t.target,j),t.target.reset()})).catch((function(t){console.log(t)})),S.style.backgroundImage="url(".concat(e,")")})),k.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(t){return n(e)}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);p(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),p(n,o,e)}))}))}(e,t)}))}(j);var P="";Promise.all([fetch("".concat(a,"users/me"),{headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(a,"cards"),{headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];C.textContent=r.name,q.textContent=r.about,S.style.backgroundImage="url(".concat(r.avatar,")"),P=r._id,c.forEach((function(t){A(t,"append")}))})).catch((function(t){console.log(t)}))})();